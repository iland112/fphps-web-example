<html xmlns:th="http://www.thymeleaf.org">
  <div id="response" th:fragment="passport-information" class="min-h-screen pb-8">
    <!-- Header Section -->
    <div class="px-4 sm:px-0 mb-2">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="text-2xl font-semibold text-gray-900">Passport Information</h3>
          <p class="mt-1 text-sm text-gray-500">
            Data details after reading the passport/e-passport
          </p>
        </div>
        <!-- Status Badge -->
        <div class="p-3 bg-green-50 rounded-lg border border-green-200">
          <div class="flex items-center gap-2">
            <svg class="size-5 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="text-sm font-semibold text-green-800">Read Success</span>
          </div>
        </div>
      </div>
    </div>
    <!-- Passport Holder Info Card -->
    <th:block
      th:if="${response != null and response.mrzInfo != null and response.ePassResults != null}"
    >
      <div class="px-4 sm:px-0 mb-2">
        <div th:replace="~{fragments/passport_cards :: passportHeader(
          mrzInfo=${response.mrzInfo},
          countryFlagId='manual-country-flag',
          passportNumberSpanId='manual-passport-number',
          nameSpanId='manual-name'
        )}"></div>
      </div>

      <!-- Tabs for E-MRTD / SOD / PA -->
      <div class="mt-4 px-4 sm:px-0">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
          <!-- Tab Navigation -->
          <nav class="flex border-b border-gray-200 bg-gray-50" aria-label="Tabs">
            <button type="button" onclick="switchTab('emrtd')" id="tab-emrtd" class="passport-tab group relative min-w-0 flex-1 overflow-hidden bg-white px-4 py-4 text-center text-sm font-medium text-gray-900 hover:bg-gray-50 focus:z-10 border-b-2 border-blue-500">
              <span>E-MRTD Data</span>
            </button>
            <button type="button" onclick="switchTab('sod')" id="tab-sod" class="passport-tab group relative min-w-0 flex-1 overflow-hidden px-4 py-4 text-center text-sm font-medium text-gray-500 hover:bg-gray-50 hover:text-gray-700 focus:z-10">
              <span>SOD Information</span>
            </button>
            <button type="button" onclick="switchTab('pa')" id="tab-pa" class="passport-tab group relative min-w-0 flex-1 overflow-hidden px-4 py-4 text-center text-sm font-medium text-gray-500 hover:bg-gray-50 hover:text-gray-700 focus:z-10">
              <span>Passive Authentication</span>
            </button>
          </nav>

          <!-- Tab Content -->
          <div class="p-6">
            <!-- E-MRTD Tab Content -->
            <div id="content-emrtd" class="tab-content block">
              <!-- Main Grid: 3 rows Ã— 3 columns -->
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                <!-- Row 1, Col 1: Photo Comparison -->
                <div th:replace="~{fragments/passport_cards :: photoComparison(
                  vizPhotoData=${response.vizPhotoImage.imageData},
                  epassPhotoData=${response.ePassPhotoImage.imageData},
                  vizPhotoId='manual-viz-photo',
                  epassPhotoId='manual-epass-photo'
                )}"></div>

                <!-- Row 1, Col 2: Personal Information -->
                <div th:replace="~{fragments/passport_cards :: personalInfo(
                  mrzInfo=${response.mrzInfo},
                  docTypeId='manual-doc-type',
                  issuingStateId='manual-issuing-state',
                  passportNumberId='manual-passport-number-info',
                  nameId='manual-name-info',
                  nationalityId='manual-nationality',
                  birthId='manual-birth',
                  sexId='manual-sex',
                  expiryDateId='manual-expiry-date'
                )}"></div>

                <!-- Row 1, Col 3: Data Group Read Results -->
                <div th:replace="~{fragments/passport_cards :: dgResults(
                  ePassResults=${response.ePassResults},
                  idPrefix='manual'
                )}"></div>

                <!-- Row 2, Col 1-2: MRZ Image (spans 2 columns) -->
                <div th:replace="~{fragments/passport_cards :: mrzImageCard(
                  mrzImageData=${response.mrzImage.imageData},
                  mrzLines=${response.mrzLines},
                  mrzPhotoId='manual-mrz-photo',
                  mrzLine1Id='manual-mrz-line-1',
                  mrzLine2Id='manual-mrz-line-2'
                )}"></div>

                <!-- Row 2, Col 3: Authentication Results -->
                <div th:replace="~{fragments/passport_cards :: authResults(
                  ePassResults=${response.ePassResults},
                  idPrefix='manual'
                )}"></div>

                <!-- Row 3, Col 1-3: Document Images (spans all 3 columns) -->
                <div th:replace="~{fragments/passport_cards :: documentImages(
                  whImageData=${response.whImage.imageData},
                  irImageData=${response.irImage.imageData},
                  uvImageData=${response.uvImage.imageData},
                  whImageId='manual-wh-image',
                  irImageId='manual-ir-image',
                  uvImageId='manual-uv-image'
                )}"></div>
              </div>
            </div>

            <!-- SOD Tab Content -->
            <div id="content-sod" class="tab-content hidden">
              <div th:replace="~{fragments/sod_information :: sodInformation(${parsedSODInfo})}"></div>
            </div>

            <!-- PA Tab Content -->
            <div id="content-pa" class="tab-content hidden">
              <div th:replace="~{fragments/pa_tab_content :: paTabContent(
                btnId='manual-verify-pa-btn',
                containerId='manual-pa-result-container',
                emptyStateId='manual-pa-empty-state',
                prefix='manual'
              )}"></div>
            </div>
          </div>
        </div>
      </div>

    </th:block>
    <div th:if="${response == null or response.mrzInfo == null}">
      <p>No passport data available.</p>
    </div>
  </div>

  <!-- Shared Passport Tabs JavaScript -->
  <script th:src="@{/js/passport-tabs.js}"></script>

  <!-- Tab Switching JavaScript -->
  <script>
    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.passport-tab').forEach(tab => {
        tab.classList.remove('bg-white', 'text-gray-900', 'border-b-2', 'border-blue-500');
        tab.classList.add('text-gray-500');
      });

      const activeTab = document.getElementById('tab-' + tabName);
      activeTab.classList.add('bg-white', 'text-gray-900', 'border-b-2', 'border-blue-500');
      activeTab.classList.remove('text-gray-500');

      // Update content visibility
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
        content.classList.remove('block');
      });

      const activeContent = document.getElementById('content-' + tabName);
      activeContent.classList.remove('hidden');
      activeContent.classList.add('block');
    }
  </script>
</html>